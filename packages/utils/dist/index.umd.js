(function(h,y){typeof exports=="object"&&typeof module<"u"?y(exports):typeof define=="function"&&define.amd?define(["exports"],y):(h=typeof globalThis<"u"?globalThis:h||self,y(h.index={}))})(this,function(h){"use strict";function y(t,e=1e3){let n=!1,s,i=1e3;e&&(i=e);const a=async()=>{try{await t()}finally{n&&(s=setTimeout(()=>{clearTimeout(s),a()},i))}};return{start:()=>{if(n)throw new Error("ready start!");n=!0,a()},stop:()=>n=!1,refresh:a,setTime:u=>{i=u}}}function M({cb:t,retryCount:e,intervalTime:n,event:s}){let i=!1,a=!1,o=()=>{};return{promise:new Promise(async(c,u)=>{o=()=>{if(i==!0)return;e=0,a=!0,i=!0;const f="Because of reason [user cancel], re-execute end";return console.warn(f),s(f),u(new Error(f))};const m=async()=>{try{const f=await t();i=!0,c(f)}catch(f){if(a)return;let d="";f instanceof Error?d=f.message:d=JSON.stringify(f);const p=`Because of reason [${d}], start re-execute on ${e}`;if(console.warn(p),s(p),e==0){const E=`Because of reason [${d}], re-execute end`;console.error(E),s(E),i=!0,u(f)}else e!==0&&(e>0&&e--,setTimeout(()=>{m()},n))}};m()}),cancel:o}}function A(t,e){let n=o=>{},s;e&&(s=setTimeout(()=>{n("execute function timeout")},e));const i=new Promise((o,r)=>{n=(c="promise aborted")=>{r(new F(c))}});return{promise:Promise.race([t,i]).then(o=>(s&&(clearTimeout(s),s=void 0),o)),abort:n}}class F extends Error{constructor(e){super(e)}}function S(t){return t&&(Array.isArray(t)?t.map(e=>S(e)):t instanceof Date?new Date(t):typeof t=="object"?Object.fromEntries(Object.entries(t).map(([e,n])=>[e,S(n)])):t)}function z(t){const e=S(t);return{data:t,defaultData:e,getClone:()=>S(e)}}class L{constructor(e){this.events={},e.forEach(n=>{Reflect.set(this.events,n,[])})}addEventListener(e,n){if(!Reflect.has(this.events,e))throw new Error(`event ${e} doesn't exist!`);this.events[e].includes(n)||this.events[e].push(n)}removeEventListener(e,n){if(!Reflect.has(this.events,e))throw new Error(`event ${e} doesn't exist!`);const s=this.events[e].indexOf(n);s!==-1&&this.events[e].splice(s,1)}dispatchEvent(e,n){if(!Reflect.has(this.events,e))throw new Error(`event ${e} doesn't exist!`);this.events[e].forEach(s=>s(n))}}function x(t={},e={}){let n;for(n in e)t[n]=G(t[n])?x(t[n],e[n]):t[n]=e[n];return t}function G(t){return Object.prototype.toString.call(t)==="[object Object]"}var U=typeof global=="object"&&global&&global.Object===Object&&global,_=typeof self=="object"&&self&&self.Object===Object&&self,I=U||_||Function("return this")(),v=I.Symbol,$=Object.prototype,q=$.hasOwnProperty,H=$.toString,b=v?v.toStringTag:void 0;function J(t){var e=q.call(t,b),n=t[b];try{t[b]=void 0;var s=!0}catch{}var i=H.call(t);return s&&(e?t[b]=n:delete t[b]),i}var X=Object.prototype,K=X.toString;function Q(t){return K.call(t)}var V="[object Null]",Y="[object Undefined]",C=v?v.toStringTag:void 0;function Z(t){return t==null?t===void 0?Y:V:C&&C in Object(t)?J(t):Q(t)}function N(t){return t!=null&&typeof t=="object"}var tt="[object Symbol]";function et(t){return typeof t=="symbol"||N(t)&&Z(t)==tt}var nt=/\s/;function it(t){for(var e=t.length;e--&&nt.test(t.charAt(e)););return e}var st=/^\s+/;function rt(t){return t&&t.slice(0,it(t)+1).replace(st,"")}function j(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var D=NaN,at=/^[-+]0x[0-9a-f]+$/i,ot=/^0b[01]+$/i,ct=/^0o[0-7]+$/i,lt=parseInt;function R(t){if(typeof t=="number")return t;if(et(t))return D;if(j(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=j(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=rt(t);var n=ot.test(t);return n||ct.test(t)?lt(t.slice(2),n?2:8):at.test(t)?D:+t}var w=function(){return I.Date.now()},ft="Expected a function",ut=Math.max,ht=Math.min;function dt(t,e,n){var s,i,a,o,r,c,u=0,m=!1,f=!1,d=!0;if(typeof t!="function")throw new TypeError(ft);e=R(e)||0,j(n)&&(m=!!n.leading,f="maxWait"in n,a=f?ut(R(n.maxWait)||0,e):a,d="trailing"in n?!!n.trailing:d);function p(l){var g=s,T=i;return s=i=void 0,u=l,o=t.apply(T,g),o}function E(l){return u=l,r=setTimeout(P,e),m?p(l):o}function pt(l){var g=l-c,T=l-u,B=e-g;return f?ht(B,a-T):B}function k(l){var g=l-c,T=l-u;return c===void 0||g>=e||g<0||f&&T>=a}function P(){var l=w();if(k(l))return W(l);r=setTimeout(P,pt(l))}function W(l){return r=void 0,d&&s?p(l):(s=i=void 0,o)}function yt(){r!==void 0&&clearTimeout(r),u=0,s=c=i=r=void 0}function bt(){return r===void 0?o:W(w())}function O(){var l=w(),g=k(l);if(s=arguments,i=this,c=l,g){if(r===void 0)return E(c);if(f)return clearTimeout(r),r=setTimeout(P,e),p(c)}return r===void 0&&(r=setTimeout(P,e)),o}return O.cancel=yt,O.flush=bt,O}const gt={searchParams:{},pageParams:{pageIndex:1,pageSize:10},pageSizes:[10,30,50],list:[],total:0,totalPage:0,getListStatus:"succeed",searchStatus:"succeed",pagingStatus:"succeed"};class mt{constructor({requestFun:e=void 0,listState:n=void 0,listType:s="replace"}){this.events=new L(["changeState"]),this.addStateChangeListener=i=>this.events.addEventListener("changeState",i),this.removeStateChangeListener=i=>this.events.removeEventListener("changeState",i),this.dispatchStateChangeListener=dt(()=>{const i=S(this.listState);this.events.dispatchEvent("changeState",i)},50),this.setListState=i=>{let a={set:(r,c,u)=>(Reflect.set(r,c,u),this.dispatchStateChangeListener(),!0)};const o=x(gt,i);return new Proxy(o,a)},this.getList=()=>new Promise((i,a)=>{this.listState.getListStatus==="loading"&&a(new Error("加载中,请稍等")),this.listState.getListStatus="loading";const o={...this.listState.searchParams,page:this.listState.pageParams};this.requestFun(o).then(r=>{this.listState.getListStatus="succeed";const{list:c,total:u,totalPage:m=0}=r;this.listState.totalPage=m,this.listState.total=u,this.listType=="replace"||this.listState.pageParams.pageIndex==1?this.listState.list=c:this.listState.list=this.listState.list.concat(c),i(r)}).catch(r=>{console.error(r),this.listState.getListStatus="failed",a(r)})}),this.handleSearch=async()=>{this.listState.searchStatus="loading",this.listState.pageParams.pageIndex=1;try{const i=await this.getList();return this.listState.searchStatus="succeed",i}catch(i){console.error("search get error:"+i),this.listState.searchStatus="failed"}},this.handlePageChange=async({pageIndex:i,pageSize:a})=>{this.listState.pagingStatus="loading",i&&(this.listState.pageParams.pageIndex=i),a&&(this.listState.pageParams.pageSize=a);try{const o=await this.getList();return this.listState.pagingStatus="succeed",o}catch(o){console.error("search get error:"+o),this.listState.pagingStatus="failed"}},e&&(this.requestFun=e),this.listState=this.setListState(n),this.listType=s}}function St(t){let e={succeed:[],fail:[]},n=!1;return async function({Locked:s,parameters:i}){return new Promise(async(a,o)=>{if(n===!1&&s===!0){n=s;try{const r=await t(i);e.succeed.map(c=>c(r))}catch(r){e.fail.map(c=>c(r))}finally{e.succeed=[],e.fail=[],n=!1}}n?(e.succeed.push(a),e.fail.push(o)):a(null)})}}h.EventsCollect=L,h.ListInstance=mt,h.cancelablePromise=A,h.dataWithDefault=z,h.deepClone=S,h.loopFunc=y,h.reExecute=M,h.syncPromise=St,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
